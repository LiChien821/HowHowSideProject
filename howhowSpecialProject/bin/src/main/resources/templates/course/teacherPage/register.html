<!DOCTYPE html>

<html xmlns:th="http://thymeleaf.org">
<head th:replace="course/fragments/fragments :: pagehead">

<body>
	<div class="container-fluid">

	
	<h2>customer Registration</h2>
	
	
		<form th:action="@{/create_customer}" method="post" style="max-width: 700px; margin: 0 auto"
			th:object="${testUser}" onsubmit="return checkEmailUnique(this);" >
			
			<div class="border boder-secondary rounded p-3">
						
			  
			  					<div class="form-group row">
			<label class="col-sm-4 col-form-label">name</label>
				<div class="col-sm-8">
					<input type="text" class="form-control" th:field="*{name}" 
					required minlength="2" maxlength="45" />
				</div>		
			  </div>
			  <div class="form-group row">
			<label class="col-sm-4 col-form-label">Roles</label>
				<div class="col-sm-8">
					<input type="text" class="form-control" th:field="*{roles}" 
					required minlength="2" maxlength="45" />
				</div>		
			  </div>
			  
			  					<div class="form-group row">
			<label class="col-sm-4 col-form-label">Email</label>
				<div class="col-sm-8">
					<input type="email" id="email" class="form-control" th:field="*{email}" 
					required minlength="2" maxlength="45" />
				</div>		
			  </div>
			  
			                      <div class="form-group row">
			<label class="col-sm-4 col-form-label">Password</label>
				<div class="col-sm-8">
					<input type="password" class="form-control" th:field="*{password}" 
					required minlength="2" maxlength="15" 
					oninput="checkPasswordMatch(document.getElementById('confirmPassword'))"/>
				</div>		
			  </div>
			                <div class="form-group row">
			<label class="col-sm-4 col-form-label">Re-type password</label>
				<div class="col-sm-8">
					<input type="password" class="form-control" id="confirmPassword" 
					required minlength="2" maxlength="45" 	oninput="checkPasswordMatch(this)"/>
				</div>		
			  </div>
			  		
			  
			  	<div class="text-center">
					<input type="submit" value="Save" class="btn btn-primary m-4" /> 
					<input type="button" value="Cancel" class="btn btn-secondary m-2" id="buttonCancel" /> 
				</div>
							
			  
			</div>
			</form>
			
			
<div class="toast" role="alert" aria-live="polite" aria-atomic="true" data-delay="10000">
  <div role="alert" aria-live="assertive" aria-atomic="true">
  	<div class="toast-body">
  		<span id="toastMessage"></span>
  	</div>
  </div>
</div>
		
	
	</div>
	



<script type="text/javascript">
	var contextPath;
	var dropdowncountry;
	var dataListState;
	var countryId;
	var statesinput;
	$(document).ready(function() {
		contextPath="[[@{/}]]";
		statesinput=$("#statesinput");
		dropdowncountry=$("#countryy");
		dataListStat=$("#listStates");
		dropdowncountry.on("change",function(){
			loadStatesforCountry();
			});
		});
		
		
		
function loadStatesforCountry(){
	selectedCountry= $("#countryy option:selected");
	countryId=selectedCountry.val();
	url= contextPath+"states/list_states_by_country/"+countryId;
	
		$.get(url,function(responseJSON){
		dataListStat.empty();
		statesinput.val("");
		$.each(responseJSON,function(index,state) {
		
			$("<option>").val(state.name).text(state.name).appendTo(dataListStat);
		
		});
	}).done(function(){
		
		showToastMessage("all");
	}).fail(function(){
		showToastMessage("fail message");
	});
	

}
function checkPasswordMatch(confirmPassword) {
	if(confirmPassword.value != $("#password").val()) {
		confirmPassword.setCustomValidity("Password dont match");
	}else {
		confirmPassword.setCustomValidity("");
	}
}
function showToastMessage(message){
	$("#toastMessage").text(message);
	$(".toast").toast('show');
	
}	

function checkEmailUnique(form) {
	
    url= contextPath+"customers/check_unique_email";

	userEmail = $("#email").val();

	csrfValue = $("input[name='_csrf']").val();
	params = {email: userEmail, _csrf: csrfValue};
	

	
	
	
	$.post(url, params, function(response) {
		if (response == "OK"){
			form.submit();
		}else if (response == "Duplicated"){
				showWaringModal("there is another:"+userEmail);
				}else{
					showErrorModal("unknown response from server");
				}
	}).fail(function() {
		showErrorModal("Cloud not connect server");
	});
	return false;
}
	

</script>
<script type="text/javascript" th:src="@{/js/common_form.js}"></script>

</body>
</html>